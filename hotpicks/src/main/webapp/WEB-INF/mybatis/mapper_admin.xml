<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.kitri.hotpicks.admin.dao.AdminDao">
 
 	<select id="getAllMembers" resultType="memberDto">
 		select userid, pass, name, age, gender, joindate, profile, enable
		from member
		order by joindate
 	</select>

 	<select id="getBlockMembers" resultType="memberDto">
 		select m.userid, m.pass, m.name, m.age, m.gender, m.joindate, m.profile, enable
		from member m, blackreview b
		where m.userid = b.userid
	 	order by b.reportdate
 	</select>
 
 	<select id="getMemberCount" resultType="map">
 		select to_char(sysdate, 'yyyy-mm-dd') statDate,
 			   (select count(*) from member where enable=1) mCnt,
 			   (select count(*) from member where enable=0) dmCnt
		from dual
 	</select>
 	
 	<update id="getOutMember" parameterType="map">
 			update member
 			set enable = 0
 			where userid in 
 		<foreach collection="userIds" item = "user" open="(" close=")" separator=","> 			
 			#{user}
 		</foreach>
 	</update>

 	<update id="outCancelMember" parameterType="map">
 			update member
 			set enable = 1
 			where userid in 
 		<foreach collection="userIds" item = "user" open="(" close=")" separator=","> 			
 			#{user}
 		</foreach>
 	</update>
 	
 	
  	<select id="getAllReviews" resultType="map">
 		select r.rseq rseq, r.userid userid, r.subject subject, DBMS_LOB.SUBSTR(r.content, 32000, 1) content, to_char(r.logtime, 'yyyy-mm-dd') logtime, b.reportcontent reportcontent, to_char(b.reportdate, 'yyyy-mm-dd') reportdate
		from review r left OUTER JOIN blackreview b
        on r.rseq = b.rseq
		order by r.logtime desc
 	</select>

 	<select id="getBlockReviews" resultType="map">
		select r.rseq rseq, r.subject subject, r.userid userid, to_char(r.logtime, 'yyyy-mm-dd') logtime, DBMS_LOB.SUBSTR(r.content, 32000, 1) content, b.reportcontent reportcontent, to_char(b.reportdate, 'yyyy-mm-dd') reportdate
		from review r, blackreview b
		where r.userid = b.userid
		order by b.reportdate
 	</select>
 
 	<select id="getReviewCount" resultType="map">
		select to_char(sysdate, 'yyyy-mm-dd') statDate,
  	   		   (select count(*) from review) rCnt,
 	   		   (select count(*) from blackreview) drCnt
		from dual
 	</select>
 	
 	<delete id="deleteReview" parameterType="map">
 		delete
		from review
		where rseq in
		<foreach collection="rseqs" item = "rseq" open="(" close=")" separator=","> 			
 			#{rseq}
 		</foreach> 
 	</delete>

 	<delete id="deleteBReview" parameterType="map">
 		delete
		from blackreview
		where rseq in
		<foreach collection="rseqs" item = "rseq" open="(" close=")" separator=","> 			
 			#{rseq}
 		</foreach> 
 	</delete>
 
 </mapper>